<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Agent - æ™ºèƒ½è¯­éŸ³åˆæˆ</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 { text-align: center; color: #333; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }
        
        /* æ¨¡å¼é€‰æ‹© */
        .mode-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        .mode-btn {
            flex: 1;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            background: white;
        }
        .mode-btn:hover { border-color: #667eea; }
        .mode-btn.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .mode-btn h3 { margin-bottom: 8px; }
        .mode-btn p { font-size: 14px; opacity: 0.8; }
        
        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .steps {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .step {
            display: flex;
            align-items: center;
            color: #999;
        }
        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-weight: bold;
        }
        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .step.active { color: #333; font-weight: bold; }
        .step-line {
            width: 60px;
            height: 2px;
            background: #e0e0e0;
            margin: 0 15px;
        }
        
        /* å†…å®¹åŒºåŸŸ */
        .section {
            margin-bottom: 25px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
        }
        textarea:focus { outline: none; border-color: #667eea; }
        
        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102,126,234,0.4); }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-success { background: #4caf50; color: white; }
        
        .file-input { margin: 15px 0; }
        
        /* åˆ†æç»“æœ */
        .analysis-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 15px 0;
            border-radius: 0 12px 12px 0;
        }
        .param-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .param-label { color: #666; }
        .param-value { font-weight: bold; color: #333; }
        
        /* éŸ³é¢‘æ’­æ”¾å™¨ */
        .audio-section {
            background: #f5f5f5;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }
        .audio-player {
            width: 100%;
            margin: 20px 0;
        }
        
        /* åé¦ˆåŒºåŸŸ */
        .feedback-section {
            margin-top: 20px;
        }
        .feedback-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        /* æç¤ºä¿¡æ¯ */
        .tip-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }
        
        /* éŸ³è‰²é€‰æ‹© */
        .voice-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        .voice-card {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        .voice-card:hover { border-color: #667eea; }
        .voice-card.active {
            border-color: #667eea;
            background: #f3e5f5;
        }
        .voice-card h4 { margin-bottom: 5px; }
        .voice-card p { font-size: 14px; color: #666; }
        
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_BASE = 'http://localhost:8000';

        function App() {
            // çŠ¶æ€ç®¡ç†
            const [mode, setMode] = useState(null); // 'clone' æˆ– 'default'
            const [phase, setPhase] = useState(1); // 1:åˆ†æ 2:åˆæˆ 3:ä¼˜åŒ–
            const [text, setText] = useState('');
            const [sessionId, setSessionId] = useState(null);
            const [analysis, setAnalysis] = useState(null);
            const [params, setParams] = useState({ speed: 1.0, pitch: 0, volume: 1.0, emotion_tag: '' });
            const [audioUrl, setAudioUrl] = useState(null);
            const [version, setVersion] = useState(0);
            const [audioCount, setAudioCount] = useState(0);
            const [feedback, setFeedback] = useState('');
            const [tips, setTips] = useState([]);
            const [voices, setVoices] = useState([]);
            const [selectedVoice, setSelectedVoice] = useState('xiaoxiao');
            const [referenceAudios, setReferenceAudios] = useState([]);
            const [loading, setLoading] = useState(false);

            // è·å–é¢„è®¾éŸ³è‰²åˆ—è¡¨
            useEffect(() => {
                fetch(`${API_BASE}/voices`)
                    .then(r => r.json())
                    .then(data => setVoices(data.voices));
            }, []);

            // é˜¶æ®µ1: æ™ºèƒ½åˆ†æ
            const startAnalysis = async () => {
                if (!text) { alert('è¯·è¾“å…¥æ–‡æœ¬'); return; }
                if (!mode) { alert('è¯·é€‰æ‹©æ¨¡å¼'); return; }

                setLoading(true);
                const formData = new FormData();
                formData.append('mode', mode);
                formData.append('text', text);
                formData.append('voice_id', selectedVoice);

                const res = await fetch(`${API_BASE}/synthesize/analyze`, {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();
                
                setSessionId(data.session_id);
                setAnalysis(data.analysis);
                setParams(data.suggested_params);
                setPhase(2);
                setLoading(false);
            };

            // é˜¶æ®µ2: åˆæˆ
            const doSynthesize = async () => {
                setLoading(true);
                const formData = new FormData();
                formData.append('session_id', sessionId);
                formData.append('speed', params.speed);
                formData.append('pitch', params.pitch);
                formData.append('volume', params.volume);
                formData.append('emotion_tag', params.emotion_tag);

                // å…‹éš†æ¨¡å¼ä¸Šä¼ éŸ³é¢‘
                if (mode === 'clone' && referenceAudios.length > 0) {
                    // ç®€åŒ–ï¼šåªä¼ ç¬¬ä¸€æ®µï¼Œå®é™…åº”è¯¥æ”¯æŒå¤šæ®µ
                }

                const res = await fetch(`${API_BASE}/synthesize`, {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();
                
                setAudioUrl(data.audio_url);
                setVersion(data.version);
                setAudioCount(data.audio_count);
                setTips(data.tips || []);
                setPhase(3);
                setLoading(false);
            };

            // é˜¶æ®µ3: åé¦ˆä¼˜åŒ–
            const [feedbackAnalysis, setFeedbackAnalysis] = useState(null);
            const [proposedParams, setProposedParams] = useState(null);
            const [feedbackPhase, setFeedbackPhase] = useState('input'); // 'input', 'analyzed', 'applied'

            // æäº¤åé¦ˆåˆ†æï¼ˆä¸åˆæˆï¼‰
            const submitFeedbackForAnalysis = async () => {
                if (!feedback) { alert('è¯·è¾“å…¥åé¦ˆ'); return; }
                
                setLoading(true);
                const formData = new FormData();
                formData.append('session_id', sessionId);
                formData.append('feedback', feedback);

                const res = await fetch(`${API_BASE}/synthesize/feedback/analyze`, {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();
                
                setFeedbackAnalysis(data);
                setProposedParams(data.proposed_params);
                setFeedbackPhase('analyzed');
                setLoading(false);
            };

            // åº”ç”¨åé¦ˆå¹¶åˆæˆ
            const applyFeedbackAndSynthesize = async () => {
                setLoading(true);
                
                // åº”ç”¨å‚æ•°åˆ° session
                if (proposedParams) {
                    setParams(proposedParams);
                }
                
                const formData = new FormData();
                formData.append('session_id', sessionId);
                formData.append('apply_adjustments', 'true');

                const res = await fetch(`${API_BASE}/synthesize/feedback/apply`, {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();
                
                setAudioUrl(data.audio_url);
                setVersion(data.version);
                setAudioCount(data.audio_count);
                setFeedbackPhase('applied');
                setFeedback('');
                setFeedbackAnalysis(null);
                setProposedParams(null);
                setLoading(false);
            };

            // å–æ¶ˆåé¦ˆè°ƒæ•´
            const cancelFeedback = () => {
                setFeedbackPhase('input');
                setFeedbackAnalysis(null);
                setProposedParams(null);
            };

            // æ·»åŠ æ›´å¤šéŸ³é¢‘
            const addMoreAudio = async (file) => {
                const formData = new FormData();
                formData.append('audio', file);
                
                const res = await fetch(`${API_BASE}/session/${sessionId}/add-audio`, {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();
                setAudioCount(data.audio_count);
                alert(data.message);
            };

            return (
                <div className="container">
                    <h1>ğŸ™ï¸ Voice Agent</h1>
                    <p className="subtitle">æ™ºèƒ½è¯­éŸ³åˆæˆ - æ”¯æŒæƒ…æ„Ÿåˆ†æä¸äº¤äº’ä¼˜åŒ–</p>

                    {/* æ­¥éª¤æŒ‡ç¤ºå™¨ */}
                    <div className="steps">
                        <div className={`step ${phase >= 1 ? 'active' : ''}`}>
                            <div className="step-number">1</div>
                            <span>è¾“å…¥&åˆ†æ</span>
                        </div>
                        <div className="step-line"></div>
                        <div className={`step ${phase >= 2 ? 'active' : ''}`}>
                            <div className="step-number">2</div>
                            <span>åˆæˆ</span>
                        </div>
                        <div className="step-line"></div>
                        <div className={`step ${phase >= 3 ? 'active' : ''}`}>
                            <div className="step-number">3</div>
                            <span>ä¼˜åŒ–</span>
                        </div>
                    </div>

                    {/* æ¨¡å¼é€‰æ‹© */}
                    {!mode && (
                        <div className="mode-selector">
                            <div className="mode-btn" onClick={() => setMode('clone')}>
                                <h3>ğŸ­ å…‹éš†éŸ³è‰²</h3>
                                <p>ä¸Šä¼ éŸ³é¢‘ï¼Œå…‹éš†ç‰¹å®šäººçš„éŸ³è‰²</p>
                            </div>
                            <div className="mode-btn" onClick={() => setMode('default')}>
                                <h3>ğŸµ é¢„è®¾éŸ³è‰²</h3>
                                <p>é€‰æ‹©å†…ç½®éŸ³è‰²ï¼Œå¿«é€Ÿåˆæˆ</p>
                            </div>
                        </div>
                    )}

                    {mode && (
                        <>
                            {/* æ¨¡å¼æ˜¾ç¤º */}
                            <div className="section">
                                <div className="section-title">
                                    å½“å‰æ¨¡å¼: {mode === 'clone' ? 'ğŸ­ å…‹éš†éŸ³è‰²' : 'ğŸµ é¢„è®¾éŸ³è‰²'}
                                    <button className="btn btn-secondary" onClick={() => setMode(null)} style={{float: 'right', marginTop: 0}}>åˆ‡æ¢</button>
                                </div>
                            </div>

                            {/* é˜¶æ®µ1: è¾“å…¥ */}
                            {phase === 1 && (
                                <>
                                    {/* å…‹éš†æ¨¡å¼ - ä¸Šä¼ éŸ³é¢‘ */}
                                    {mode === 'clone' && (
                                        <div className="section">
                                            <div className="section-title">1. ä¸Šä¼ å‚è€ƒéŸ³é¢‘</div>
                                            <input 
                                                type="file" 
                                                accept="audio/*" 
                                                className="file-input"
                                                onChange={(e) => {
                                                    if (e.target.files[0]) {
                                                        setReferenceAudios([e.target.files[0]]);
                                                    }
                                                }}
                                            />
                                            <div className="tip-box">
                                                ğŸ’¡ å»ºè®®ä¸Šä¼  10-30 ç§’æ¸…æ™°éŸ³é¢‘ï¼Œå¯ä¸Šä¼ å¤šæ®µèåˆ
                                            </div>
                                        </div>
                                    )}

                                    {/* æ™®é€šæ¨¡å¼ - é€‰æ‹©éŸ³è‰² */}
                                    {mode === 'default' && (
                                        <div className="section">
                                            <div className="section-title">1. é€‰æ‹©éŸ³è‰²</div>
                                            <div className="voice-grid">
                                                {voices.map(v => (
                                                    <div 
                                                        key={v.id}
                                                        className={`voice-card ${selectedVoice === v.id ? 'active' : ''}`}
                                                        onClick={() => setSelectedVoice(v.id)}
                                                    >
                                                        <h4>{v.name}</h4>
                                                        <p>{v.description}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* æ–‡æœ¬è¾“å…¥ */}
                                    <div className="section">
                                        <div className="section-title">2. è¾“å…¥æ–‡æœ¬</div>
                                        <textarea 
                                            value={text}
                                            onChange={(e) => setText(e.target.value)}
                                            placeholder="è¯·è¾“å…¥è¦åˆæˆçš„æ–‡å­—..."
                                        />
                                        <button className="btn btn-primary" onClick={startAnalysis} disabled={loading}>
                                            {loading ? 'åˆ†æä¸­...' : 'ğŸ” æ™ºèƒ½åˆ†æ'}
                                        </button>
                                    </div>
                                </>
                            )}

                            {/* é˜¶æ®µ2: åˆ†æç»“æœ & ç¡®è®¤åˆæˆ */}
                            {phase === 2 && analysis && (
                                <>
                                    <div className="section">
                                        <div className="section-title">ğŸ“Š æ™ºèƒ½åˆ†æç»“æœ</div>
                                        <div className="analysis-box">
                                            <div className="param-row">
                                                <span className="param-label">åœºæ™¯</span>
                                                <span className="param-value">{analysis.scene}</span>
                                            </div>
                                            <div className="param-row">
                                                <span className="param-label">æƒ…ç»ª</span>
                                                <span className="param-value">{analysis.emotion}</span>
                                            </div>
                                            <div className="param-row">
                                                <span className="param-label">é£æ ¼</span>
                                                <span className="param-value">{analysis.style}</span>
                                            </div>
                                            <div className="param-row">
                                                <span className="param-label">åˆ†æç†ç”±</span>
                                                <span>{analysis.reason}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="section">
                                        <div className="section-title">âš™ï¸ åˆæˆå‚æ•°ï¼ˆå¯è°ƒæ•´ï¼‰</div>
                                        <div className="param-row">
                                            <span className="param-label">è¯­é€Ÿ</span>
                                            <input 
                                                type="range" min="0.5" max="2.0" step="0.1"
                                                value={params.speed}
                                                onChange={(e) => setParams({...params, speed: parseFloat(e.target.value)})}
                                            />
                                            <span>{params.speed}</span>
                                        </div>
                                        <div className="param-row">
                                            <span className="param-label">éŸ³è°ƒ</span>
                                            <input 
                                                type="range" min="-5" max="5" step="1"
                                                value={params.pitch}
                                                onChange={(e) => setParams({...params, pitch: parseInt(e.target.value)})}
                                            />
                                            <span>{params.pitch}</span>
                                        </div>
                                        <div className="param-row">
                                            <span className="param-label">æƒ…æ„Ÿæ ‡ç­¾</span>
                                            <select 
                                                value={params.emotion_tag}
                                                onChange={(e) => setParams({...params, emotion_tag: e.target.value})}
                                            >
                                                <option value="">æ— </option>
                                                <option value="(happy)">å¼€å¿ƒ</option>
                                                <option value="(angry)">ç”Ÿæ°”</option>
                                                <option value="(sad)">æ‚²ä¼¤</option>
                                                <option value="(excited)">å…´å¥‹</option>
                                                <option value="(serious)">ä¸¥è‚ƒ</option>
                                                <option value="(soft)">æ¸©æŸ”</option>
                                            </select>
                                        </div>
                                        <button className="btn btn-primary" onClick={doSynthesize} disabled={loading}>
                                            {loading ? 'åˆæˆä¸­...' : 'ğŸµ å¼€å§‹åˆæˆ'}
                                        </button>
                                    </div>
                                </>
                            )}

                            {/* é˜¶æ®µ3: æ’­æ”¾ & åé¦ˆ */}
                            {phase === 3 && audioUrl && (
                                <>
                                    <div className="audio-section">
                                        <div className="section-title">ğŸ§ åˆæˆç»“æœï¼ˆç¬¬{version}ç‰ˆï¼‰</div>
                                        <audio controls src={`${API_BASE}${audioUrl}`} className="audio-player" />
                                        
                                        {/* æ˜¾ç¤ºå‚æ•°è°ƒæ•´ç»“æœ */}
                                        {feedbackAnalysis && feedbackPhase === 'applied' && (
                                            <div className="analysis-box" style={{marginBottom: '15px'}}>
                                                <div style={{display: 'flex', alignItems: 'center', marginBottom: '10px'}}>
                                                    <span style={{color: '#4caf50', marginRight: '8px'}}>âœ…</span>
                                                    <span style={{fontWeight: 'bold'}}>å·²æ ¹æ®åé¦ˆè°ƒæ•´å‚æ•°</span>
                                                </div>
                                                <div style={{fontSize: '14px', color: '#666'}}>
                                                    <div className="param-row" style={{margin: '5px 0'}}>
                                                        <span className="param-label">è¯­é€Ÿ</span>
                                                        <span>{feedbackAnalysis.current_params.speed}</span>
                                                        <span style={{margin: '0 8px'}}>â†’</span>
                                                        <span style={{color: '#4caf50', fontWeight: 'bold'}}>{feedbackAnalysis.proposed_params.speed}</span>
                                                    </div>
                                                    <div className="param-row" style={{margin: '5px 0'}}>
                                                        <span className="param-label">éŸ³è°ƒ</span>
                                                        <span>{feedbackAnalysis.current_params.pitch}</span>
                                                        <span style={{margin: '0 8px'}}>â†’</span>
                                                        <span style={{color: '#4caf50', fontWeight: 'bold'}}>{feedbackAnalysis.proposed_params.pitch}</span>
                                                    </div>
                                                    {feedbackAnalysis.proposed_params.emotion_tag && (
                                                        <div className="param-row" style={{margin: '5px 0'}}>
                                                            <span className="param-label">æƒ…æ„Ÿ</span>
                                                            <span>{feedbackAnalysis.current_params.emotion_tag || 'æ— '}</span>
                                                            <span style={{margin: '0 8px'}}>â†’</span>
                                                            <span style={{color: '#4caf50', fontWeight: 'bold'}}>{feedbackAnalysis.proposed_params.emotion_tag}</span>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        )}
                                        
                                        {tips.length > 0 && (
                                            <div className="tip-box">
                                                {tips.map((tip, i) => <div key={i}>{tip}</div>)}
                                            </div>
                                        )}

                                        {/* æ·»åŠ æ›´å¤šéŸ³é¢‘ */}
                                        {mode === 'clone' && audioCount < 3 && (
                                            <div style={{marginTop: '15px'}}>
                                                <input 
                                                    type="file" 
                                                    accept="audio/*"
                                                    onChange={(e) => e.target.files[0] && addMoreAudio(e.target.files[0])}
                                                />
                                            </div>
                                        )}
                                    </div>

                                    <div className="section feedback-section">
                                        <div className="section-title">ğŸ’¬ åé¦ˆä¼˜åŒ–</div>
                                        
                                        {/* è¾“å…¥åé¦ˆ */}
                                        {feedbackPhase === 'input' && (
                                            <>
                                                {/* æ˜¾ç¤ºå½“å‰å‚æ•°å’Œåˆ†æ */}
                                                {analysis && (
                                                    <div className="analysis-box" style={{marginBottom: '15px'}}>
                                                        <h4 style={{marginBottom: '10px'}}>ğŸ“Š å½“å‰å‚æ•°ä¸åˆ†æ</h4>
                                                        <div className="param-row">
                                                            <span className="param-label">åœºæ™¯</span>
                                                            <span className="param-value">{analysis.scene}</span>
                                                        </div>
                                                        <div className="param-row">
                                                            <span className="param-label">æƒ…ç»ª</span>
                                                            <span className="param-value">{analysis.emotion}</span>
                                                        </div>
                                                        <div className="param-row">
                                                            <span className="param-label">é£æ ¼</span>
                                                            <span className="param-value">{analysis.style}</span>
                                                        </div>
                                                        <div style={{marginTop: '10px', paddingTop: '10px', borderTop: '1px solid #e0e0e0'}}>
                                                            <div className="param-row">
                                                                <span className="param-label">è¯­é€Ÿ</span>
                                                                <span className="param-value">{params.speed}</span>
                                                            </div>
                                                            <div className="param-row">
                                                                <span className="param-label">éŸ³è°ƒ</span>
                                                                <span className="param-value">{params.pitch}</span>
                                                            </div>
                                                            <div className="param-row">
                                                                <span className="param-label">æƒ…æ„Ÿæ ‡ç­¾</span>
                                                                <span className="param-value">{params.emotion_tag || 'æ— '}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                <p>è¯•å¬åï¼Œæè¿°æ‚¨çš„æ„Ÿè§‰ï¼š</p>
                                                <ul style={{margin: '10px 0', color: '#666'}}>
                                                    <li>"å¤ªå¹´è½»äº†ï¼Œè¦æˆç†Ÿç‚¹"</li>
                                                    <li>"éŸ³è°ƒå¤ªå°–ï¼Œè¦ä½æ²‰äº›"</li>
                                                    <li>"è¯­é€Ÿå¤ªå¿«ï¼Œæ…¢ä¸€ç‚¹"</li>
                                                </ul>
                                                <input 
                                                    type="text"
                                                    className="feedback-input"
                                                    value={feedback}
                                                    onChange={(e) => setFeedback(e.target.value)}
                                                    placeholder="è¾“å…¥æ‚¨çš„åé¦ˆ..."
                                                />
                                                <button className="btn btn-success" onClick={submitFeedbackForAnalysis} disabled={loading}>
                                                    {loading ? 'åˆ†æä¸­...' : 'ğŸ” åˆ†æåé¦ˆ'}
                                                </button>
                                            </>
                                        )}
                                        
                                        {/* æ˜¾ç¤ºåˆ†æç»“æœï¼Œç­‰å¾…ç¡®è®¤ */}
                                        {feedbackPhase === 'analyzed' && feedbackAnalysis && (
                                            <>
                                                <div className="analysis-box" style={{marginBottom: '20px'}}>
                                                    <h4 style={{marginBottom: '10px'}}>ğŸ¤– å¤§æ¨¡å‹ç†è§£</h4>
                                                    <p style={{marginBottom: '15px', color: '#333'}}>{feedbackAnalysis.analysis}</p>
                                                    
                                                    <h4 style={{marginBottom: '10px'}}>ğŸ“Š å‚æ•°è°ƒæ•´</h4>
                                                    <div className="param-row">
                                                        <span className="param-label">å½“å‰è¯­é€Ÿ</span>
                                                        <span className="param-value">{feedbackAnalysis.current_params.speed}</span>
                                                        <span style={{margin: '0 10px'}}>â†’</span>
                                                        <span className="param-value" style={{color: '#4caf50'}}>{feedbackAnalysis.proposed_params.speed}</span>
                                                    </div>
                                                    <div className="param-row">
                                                        <span className="param-label">å½“å‰éŸ³è°ƒ</span>
                                                        <span className="param-value">{feedbackAnalysis.current_params.pitch}</span>
                                                        <span style={{margin: '0 10px'}}>â†’</span>
                                                        <span className="param-value" style={{color: '#4caf50'}}>{feedbackAnalysis.proposed_params.pitch}</span>
                                                    </div>
                                                    <div className="param-row">
                                                        <span className="param-label">æƒ…æ„Ÿæ ‡ç­¾</span>
                                                        <span className="param-value">{feedbackAnalysis.current_params.emotion_tag || 'æ— '}</span>
                                                        <span style={{margin: '0 10px'}}>â†’</span>
                                                        <span className="param-value" style={{color: '#4caf50'}}>{feedbackAnalysis.proposed_params.emotion_tag || 'æ— '}</span>
                                                    </div>
                                                </div>
                                                
                                                {/* æœ‰è°ƒæ•´æ—¶æ˜¾ç¤ºç¡®è®¤æŒ‰é’®ï¼Œæ— è°ƒæ•´æ—¶åªæ˜¾ç¤ºå–æ¶ˆ */}
                                                {feedbackAnalysis.adjustments && Object.keys(feedbackAnalysis.adjustments).length > 0 ? (
                                                    <>
                                                        <button className="btn btn-success" onClick={applyFeedbackAndSynthesize} disabled={loading}>
                                                            {loading ? 'åˆæˆä¸­...' : 'âœ… ç¡®è®¤å¹¶é‡æ–°åˆæˆ'}
                                                        </button>
                                                        <button className="btn btn-secondary" onClick={cancelFeedback} disabled={loading} style={{marginLeft: '10px'}}>
                                                            âŒ å–æ¶ˆ
                                                        </button>
                                                    </>
                                                ) : (
                                                    <div style={{color: '#666', padding: '10px 0'}}>
                                                        ğŸ’¡ æœªè¯†åˆ«åˆ°éœ€è¦è°ƒæ•´çš„å‚æ•°ï¼Œè¯·å°è¯•å…¶ä»–æè¿°
                                                        <button className="btn btn-secondary" onClick={cancelFeedback} disabled={loading} style={{marginLeft: '10px'}}>
                                                            è¿”å›
                                                        </button>
                                                    </div>
                                                )}
                                            </>
                                        )}
                                        
                                        {/* æ“ä½œæŒ‰é’® */}
                                        <div style={{marginTop: '20px'}}>
                                            <button className="btn btn-primary" onClick={doSynthesize} disabled={loading}>
                                                ğŸ”„ ç”¨å½“å‰å‚æ•°é‡æ–°åˆæˆ
                                            </button>
                                            <button className="btn btn-secondary" onClick={() => { setPhase(1); setText(''); setFeedbackPhase('input'); }} style={{marginLeft: '10px'}}>
                                                ğŸ“ æ–°å»ºåˆæˆ
                                            </button>
                                        </div>
                                    </div>
                                </>
                            )}
                        </>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
